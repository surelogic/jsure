<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.2"?>
<plugin>
	<extension-point id="analysisModule" name="JSure Analysis Modules"
		schema="schema/analysisModule.exsd" />

	<extension point="org.eclipse.ui.preferencePages">
		<page name="JSure"
			class="com.surelogic.jsure.client.eclipse.preferences.JSurePreferencePage"
			id="com.surelogic.jsure.client.eclipse.preferences.JSurePreferencePage">
		</page>
		<page name="Analyses" class="edu.cmu.cs.fluid.dc.PreferencePage"
			id="edu.cmu.cs.fluid.dc.PreferencePage"
			category="com.surelogic.jsure.client.eclipse.preferences.JSurePreferencePage">
		</page>
	</extension>
	<extension point="org.eclipse.ui.propertyPages">
		<page objectClass="org.eclipse.jdt.core.IJavaProject" name="JSure"
			class="edu.cmu.cs.fluid.dc.PropertyPage" id="edu.cmu.cs.fluid.dc.PropertyPage">
			<filter name="nature" value="org.eclipse.jdt.core.javanature">
			</filter>
		</page>
		<page objectClass="org.eclipse.core.resources.IProject" name="JSure Assurance Tool"
			class="edu.cmu.cs.fluid.dc.PropertyPage" id="edu.cmu.cs.fluid.dc.PropertyPage">
			<filter name="nature" value="org.eclipse.jdt.core.javanature">
			</filter>
		</page>
	</extension>
	<extension id="dcNature" name="double-checker Nature"
		point="org.eclipse.core.resources.natures">
		<runtime>
			<run class="edu.cmu.cs.fluid.dc.Nature">
				<parameter name="installBuilder" value="true">
				</parameter>
			</run>
		</runtime>
		<requires-nature id="org.eclipse.jdt.core.javanature">
		</requires-nature>
		<builder id="com.surelogic.jsure.client.eclipse.dcBuilder"></builder>
	</extension>
	<extension id="dcBuilder" name="JSure Assurance Tool"
		point="org.eclipse.core.resources.builders">
		<builder hasNature="true">
			<run class="edu.cmu.cs.fluid.dc.Majordomo"></run>
		</builder>
	</extension>

	<extension point="org.eclipse.ui.decorators">
		<decorator lightweight="true" adaptable="true"
			label="%jSure.decorator.label" icon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_decr.gif" state="true"
			id="jSureDecorator">
			<description>%jSure.decorator.desc</description>
			<enablement>
				<and>
					<objectClass name="org.eclipse.core.resources.IProject" />
					<objectState name="nature"
						value="com.surelogic.jsure.client.eclipse.dcNature" />
				</and>
			</enablement>
		</decorator>
	</extension>

	<extension id="UpdateSuperRootStorage" name="UWM Bridge"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.util.UpdateSuperRootStorage"
			category="required">
		</run>
	</extension>
	<extension id="PackageLevelPreprocessing" name="Preprocessor for package-level constructs"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.util.PackageLevelPreprocessing"
			category="required">
		</run>
		<prerequisite
			id="com.surelogic.jsure.client.eclipse.UpdateSuperRootStorage">
		</prerequisite>
	</extension>
	<extension id="ConvertToIR" name="eAST to fAST Converter"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.util.ConvertToIR" category="required">
		</run>
		<prerequisite
			id="com.surelogic.jsure.client.eclipse.PackageLevelPreprocessing">
		</prerequisite>
	</extension>
	<extension id="PromiseParser" name="Promise Parser"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.util.PromiseParser"
			category="required">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.ConvertToIR">
		</prerequisite>
	</extension>
	<extension id="PromiseScrubber" name="Promise Scrubber"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.util.PromiseScrubber"
			category="required">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseParser">
		</prerequisite>
	</extension>
	<extension id="DeleteIR" name="DeleteIR"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.util.DeleteIR" production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseScrubber">
		</prerequisite>
	</extension>
	<extension id="TestMultipleProjects" name="TestMultipleProjects"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.util.TestMultipleProjects"
			production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseScrubber">
		</prerequisite>
	</extension>
	<extension id="ConcurrencyDetector" name="Concurrency detector"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.threads.ConcurrencyDetector"
			production="false">
		</run>
	</extension>
	<extension id="IRConcurrencyDetector" name="IR Concurrency detector"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.threads.IRConcurrencyDetector">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseScrubber">
		</prerequisite>
	</extension>
	<extension id="Static State Detector" name="Static state detector"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.lock.StaticStateDetector"
			production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseScrubber">
		</prerequisite>
	</extension>
	<extension id="LockAssurance3" name="Greenhouse Lock Assurance (Converted)"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="com.surelogic.analysis.locks.LockAnalysis">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseScrubber">
		</prerequisite>
	</extension>
	<extension id="UniquenessAssurance2" name="Uniqueness Assurance (Converted)"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="com.surelogic.analysis.uniqueness.UniquenessAnalysisModule">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseScrubber">
		</prerequisite>
	</extension>
	<extension id="MakeCFGDiagram" name="CFG diagram Maker"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.cfg.MakeCFGDiagram"
			production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseScrubber">
		</prerequisite>
	</extension>
	<extension id="ModuleAnalysis" name="Module Visibility Analyzer"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.modules.ModuleAnalysis"
			production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseScrubber">
		</prerequisite>
	</extension>
	<extension id="ModuleAnalysis2" name="Module Visibility Analyzer (Converted)"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.modules.ModuleAnalysis2"
			production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseScrubber">
		</prerequisite>
	</extension>
	<extension id="EffectAssurance2" name="Greenhouse &amp; Boyland Effects (Converted)"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="com.surelogic.analysis.effects.EffectsAnalysis">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseScrubber">
		</prerequisite>
	</extension>
	<extension id="EffectDumper" name="Effect Dumper"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.effects.EffectDumper"
			production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseScrubber">
		</prerequisite>
	</extension>
	<extension id="NonNull" name="Non Null Analysis"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="com.surelogic.nonnull.NonNull" production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseScrubber">
		</prerequisite>
	</extension>
	<extension id="ThreadEffectAssurance2" name="Halloran Thread Effects (Converted)"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="com.surelogic.analysis.threads.ThreadEffectsModule">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseScrubber">
		</prerequisite>
	</extension>
	<extension id="StructureAnalysis" name="Program Static Structure Verification"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.structure.Structure"
			production="false">
		</run>
	</extension>
	<extension id="ColorZerothPass" name="Coloring Zeroth Pass"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.colors.ColorZerothPass"
			production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.ModuleAnalysis">
		</prerequisite>
	</extension>
	<extension id="ManageColorAnnos" name="Coloring Annotation Grabber"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.colors.ManageColorAnnos"
			production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.ColorZerothPass">
		</prerequisite>
	</extension>
	<extension id="ColorAssurance" name="Thread Color Assurance"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.colors.ColorAssurance"
			production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.ManageColorAnnos">
		</prerequisite>
	</extension>
	<extension id="UseTypeWherePossible" name="Type Use Guidance"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run
			class="edu.cmu.cs.fluid.analysis.usetypewherepossible.UseTypeWherePossibleGuidance"
			production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.PromiseScrubber">
		</prerequisite>
	</extension>

	<extension id="ColorZerothPass1" name="Coloring Zeroth Pass (Converted)"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.colors.ColorZerothPass1"
			production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.ModuleAnalysis2">
		</prerequisite>
	</extension>
	<extension id="ManageColorAnnos1" name="Coloring Annotation Grabber (Converted)"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.colors.ManageColorAnnos1"
			production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.ColorZerothPass1">
		</prerequisite>
	</extension>
	<extension id="ColorAssurance1" name="Thread Color Assurance (Converted)"
		point="com.surelogic.jsure.client.eclipse.analysisModule">
		<run class="edu.cmu.cs.fluid.analysis.colors.ColorAssurance1"
			production="false">
		</run>
		<prerequisite id="com.surelogic.jsure.client.eclipse.ManageColorAnnos1">
		</prerequisite>
	</extension>

	<extension point="org.eclipse.ui.views">
		<category name="JSure" id="edu.cmu.cs.fluid.dcf"></category>
		<view name="Verification Status"
			icon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_logo.gif"
			category="edu.cmu.cs.fluid.dcf" class="edu.cmu.cs.fluid.dcf.views.coe.ResultsView"
			id="edu.cmu.cs.fluid.dcf.views.coe.ResultsView">
		</view>

		<view name="JSure Verification Status Diffs" icon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/link.gif"
			category="edu.cmu.cs.fluid.dcf" class="edu.cmu.cs.fluid.dcf.views.coe.DiffResultsView"
			id="edu.cmu.cs.fluid.dcf.views.coe.DiffResultsView">
		</view>

		<view name="JSure Verification Metrics" icon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/link.gif"
			category="edu.cmu.cs.fluid.dcf" class="edu.cmu.cs.fluid.dcf.views.metrics.MetricsView"
			id="edu.cmu.cs.fluid.dcf.views.coe.MetricsView">
		</view>

		<view name="FAST Viewer" category="edu.cmu.cs.fluid.dcf"
			class="edu.cmu.cs.fluid.dcf.views.ast.FastViewer" id="edu.cmu.cs.fluid.dcf.views.ast.FastViewer">
		</view>

		<view name="Modeling Problems"
			icon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_model_problems.gif"
			category="edu.cmu.cs.fluid.dcf" class="edu.cmu.cs.fluid.dcf.views.coe.ProblemsView"
			id="edu.cmu.cs.fluid.dcf.views.coe.ProblemsView">
		</view>
	</extension>

	<extension point="org.eclipse.core.runtime.preferences">
		<initializer
			class="com.surelogic.jsure.client.eclipse.preferences.PreferenceInitializer" />
	</extension>

	<!-- JSure perspective links and Java perspective links -->

	<extension point="org.eclipse.ui.perspectives">
		<perspective name="Code Verification"
			icon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_logo.gif"
			class="com.surelogic.jsure.perspectives.CodeVerificationPerspective"
			id="com.surelogic.jsure.perspectives.CodeVerificationPerspective">
		</perspective>
	</extension>

	<extension point="org.eclipse.ui.perspectiveExtensions">
		<perspectiveExtension
			targetID="com.surelogic.jsure.perspectives.CodeVerificationPerspective">
			<perspectiveShortcut id="org.eclipse.jdt.ui.JavaPerspective">
			</perspectiveShortcut>
			<viewShortcut
				id="edu.cmu.cs.fluid.dcf.views.coe.ResultsView">
			</viewShortcut>
			<viewShortcut
				id="edu.cmu.cs.fluid.dcf.views.coe.ProblemsView">
			</viewShortcut>
		</perspectiveExtension>
	</extension>

	<extension point="org.eclipse.ui.perspectiveExtensions">
		<perspectiveExtension targetID="org.eclipse.jdt.ui.JavaPerspective">
			<perspectiveShortcut
				id="com.surelogic.jsure.perspectives.CodeVerificationPerspective">
			</perspectiveShortcut>
		</perspectiveExtension>
	</extension>

	<!-- JSure menus -->

	<extension point="org.eclipse.ui.actionSets">
		<actionSet label="JSure ActionSet" visible="true"
			id="com.surelogic.jsure.client.eclipse.workbenchActionSet">
			<menu id="com.surelogic.jsure.client.eclipse.workbenchMenu"
				label="JSure" path="additions">

				<groupMarker name="client" />
				<separator name="integration" />
				<separator name="admin" />
				<separator name="service" />
				<separator name="license" />
				<separator name="additions" />
			</menu>

			<action
				id="com.surelogic.jsure.client.eclipse.actions.ShowCodeVerificationPerspectiveAction"
				icon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_logo.gif"
				menubarPath="com.surelogic.jsure.client.eclipse.workbenchMenu/client"
				label="Open Code Verification Perspective"
				class="com.surelogic.jsure.client.eclipse.actions.OpenCodeVerificationPerspectiveAction">
			</action>

			<action
				class="com.surelogic.jsure.client.eclipse.actions.RemoveFluidNatureFromAllProjectsAction"
				id="com.surelogic.jsure.client.eclipse.actions.RemoveFluidNatureFromAllProjectsAction"
				icon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_no_verify.gif"
				disabledIcon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_no_verify_gray.gif"
				label="Disable Verification Of All Projects" tooltip="Set a particular project to be verified by the JSure tool"
				menubarPath="com.surelogic.jsure.client.eclipse.workbenchMenu/client">
			</action>

			<action
				class="com.surelogic.jsure.client.eclipse.actions.FocusVerificationAction"
				id="com.surelogic.jsure.client.eclipse.actions.FocusVerificationAction"
				icon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_verify.gif"
				disabledIcon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_verify_gray.gif"
				label="Focus Verification..." tooltip="Set a particular project to be verified by the JSure tool"
				menubarPath="com.surelogic.jsure.client.eclipse.workbenchMenu/client">
			</action>

			<action
				class="com.surelogic.jsure.client.eclipse.actions.ManageLicensesAction"
				id="com.surelogic.jsure.client.eclipse.actions.ManageLicensesAction"
				label="Manage SureLogic Licenses" menubarPath="com.surelogic.jsure.client.eclipse.workbenchMenu/license"
				helpContextId="menu-manage-licenses">
			</action>

			<action
				class="com.surelogic.jsure.client.eclipse.actions.SendProblemAction"
				id="com.surelogic.jsure.client.eclipse.actions.SendProblemAction"
				label="Send Problem Report" menubarPath="com.surelogic.jsure.client.eclipse.workbenchMenu/service"
				helpContextId="menu-send-problem-report">
			</action>

			<action class="com.surelogic.jsure.client.eclipse.actions.SendTipAction"
				id="com.surelogic.jsure.client.eclipse.actions.SendTipAction" label="Send Tip for Improvement"
				menubarPath="com.surelogic.jsure.client.eclipse.workbenchMenu/service"
				helpContextId="menu-send-tip-for-improvement">
			</action>

		</actionSet>
	</extension>

	<extension point="org.eclipse.ui.commands">
		<category name="JSure" description="Commands for JSure"
			id="com.surelogic.jsure.client.eclipse.actions">
		</category>
		<command name="Verification Status" description="Open verification status window"
			categoryId="com.surelogic.jsure.client.eclipse.actions" id="com.surelogic.jsure.view.client.eclipse.status">
		</command>
	</extension>

	<extension id="dcPopupMenus" point="org.eclipse.ui.popupMenus">
		<objectContribution id="iprojectContribution"
			objectClass="org.eclipse.core.resources.IProject" adaptable="true">

			<visibility>
				<and>
					<objectState name="nature" value="org.eclipse.jdt.core.javanature" />
					<objectState name="open" value="true" />
				</and>
			</visibility>

			<menu id="jSureMenu" label="JSure">
				<groupMarker name="nature.grp" />
			</menu>

			<action id="com.surelogic.jsure.client.eclipse.oc.removeNature"
				label="Disable Verification"
				icon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_no_verify.gif"
				disabledIcon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_no_verify_gray.gif"
				tooltip="Disables JSure analysis for the selected projects"
				menubarPath="jSureMenu/nature.grp"
				class="com.surelogic.jsure.client.eclipse.actions.RemoveFluidNatureAction"
				enablesFor="+">
				<enablement>
					<objectState name="nature"
						value="com.surelogic.jsure.client.eclipse.dcNature" />
				</enablement>
			</action>

			<action id="com.surelogic.jsure.client.eclipse.oc.focusNature"
				label="Focus Verification on this Project"
				icon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_verify.gif"
				disabledIcon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_verify_gray.gif"
				tooltip="Enables JSure analysis for the selected project, and disables assurance for all other projects"
				menubarPath="jSureMenu/nature.grp"
				class="com.surelogic.jsure.client.eclipse.actions.FocusFluidNatureAction"
				enablesFor="1">
				<enablement>
					<not>
						<objectState name="nature"
							value="com.surelogic.jsure.client.eclipse.dcNature" />
					</not>
				</enablement>
			</action>
		</objectContribution>
	</extension>

	<extension point="org.eclipse.ui.viewActions">
		<viewContribution id="org.cmu.cs.fluid.dc.projectexplorer.actions"
			targetID="org.eclipse.jdt.ui.PackageExplorer">

			<action id="com.surelogic.jsure.client.eclipse.va.focusNature"
				label="Focus Verification on this Project"
				icon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_verify.gif"
				disabledIcon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_verify_gray.gif"
				tooltip="Enables JSure analysis for the selected project, and disables assurance for all other projects"
				toolbarPath="JSure" menubarPath="additions"
				class="com.surelogic.jsure.client.eclipse.actions.FocusFluidNatureAction"
				enablesFor="1">
				<enablement>
					<and>
						<objectClass name="org.eclipse.jdt.core.IJavaProject" />
						<not>
							<objectState name="nature"
								value="com.surelogic.jsure.client.eclipse.dcNature" />
						</not>
					</and>
				</enablement>
			</action>

			<action id="com.surelogic.jsure.client.eclipse.va.removeNature"
				label="Disable Verification"
				icon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_no_verify.gif"
				disabledIcon="platform:/plugin/com.surelogic.common/src/com/surelogic/common/images/jsure_no_verify_gray.gif"
				tooltip="Disables JSure analysis for the selected projects"
				toolbarPath="JSure" menubarPath="additions"
				class="com.surelogic.jsure.client.eclipse.actions.RemoveFluidNatureAction"
				enablesFor="+">
				<enablement>
					<and>
						<objectClass name="org.eclipse.jdt.core.IJavaProject" />
						<objectState name="nature"
							value="com.surelogic.jsure.client.eclipse.dcNature" />
					</and>
				</enablement>
			</action>
		</viewContribution>
	</extension>

	<extension point="org.eclipse.ui.editors.templates">
		<contextType name="JSure Java Context"
			class="org.eclipse.jdt.internal.corext.template.java.JavaContextType"
			id="java" />
		<include file="lib/templates/default-jsure-java5-templates.xml" />
	</extension>
</plugin>
